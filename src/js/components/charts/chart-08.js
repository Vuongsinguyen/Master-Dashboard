import ApexCharts from "apexcharts";

// Mock data for all companies - tổng hợp issues theo giờ và ngày
function generateMockDataForAllCompanies() {
  const companies = [
    'heineken-vietnam-brewery',
    'ttc-group',
    'moshi-moshi-ramen',
    'p2p-agency',
    'e-picos',
    'hung-thinh-land',
    'land-tsn-air',
    'hoan-my-hospital'
  ];
  
  const data = [];
  const daysOfWeek = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
  
  for (let day = 0; day < 7; day++) {
    const dayData = [];
    for (let hour = 0; hour < 24; hour++) {
      // Tổng issues từ tất cả các công ty
      let totalIssues = 0;
      
      // Base issues
      totalIssues += Math.floor(Math.random() * 2);
      
      // Morning rush (7:00-9:00) - moderate
      if (hour >= 7 && hour <= 9) {
        totalIssues += Math.floor(Math.random() * 4) + 2;
      }
      // Lunch time peak (11:00-14:00) - high
      else if (hour >= 11 && hour <= 14) {
        totalIssues += Math.floor(Math.random() * 8) + 6;
      }
      // Afternoon (15:00-17:00) - moderate
      else if (hour >= 15 && hour <= 17) {
        totalIssues += Math.floor(Math.random() * 5) + 3;
      }
      // Dinner time peak (18:00-21:00) - very high
      else if (hour >= 18 && hour <= 21) {
        totalIssues += Math.floor(Math.random() * 12) + 10;
      }
      // Late night (22:00-23:00) - low
      else if (hour >= 22) {
        totalIssues += Math.floor(Math.random() * 3) + 1;
      }
      
      // Weekend has significantly more issues
      if (day >= 5) {
        totalIssues += Math.floor(Math.random() * 8) + 5;
      }
      
      // Friday has more issues
      if (day === 4) {
        totalIssues += Math.floor(Math.random() * 4) + 2;
      }
      
      dayData.push(totalIssues);
    }
    data.push(dayData);
  }
  
  return data;
}

// Time-based issue data
const timeData = {
  "heineken-vietnam-brewery": {
    "issues": [
      [
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        1,
        2,
        1,
        1,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0
      ],
      [
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        2,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        2,
        1,
        2,
        1,
        0,
        0
      ],
      [
        0,
        2,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        1,
        1
      ],
      [
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        1,
        0,
        0
      ],
      [
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        1,
        2,
        1,
        0,
        0,
        1,
        0,
        1,
        1,
        0,
        0,
        1
      ],
      [
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        1,
        0,
        0,
        1,
        0,
        0,
        0
      ],
      [
        2,
        0,
        1,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0
      ]
    ]
  },
  "ttc-group": {
    "issues": [
      [
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        2,
        0,
        0,
        0,
        0
      ],
      [
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1
      ],
      [
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        2,
        0,
        1,
        2,
        0,
        0,
        1,
        0,
        3,
        0,
        0,
        0,
        1,
        2,
        0,
        0,
        0
      ],
      [
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        2
      ],
      [
        0,
        0,
        0,
        1,
        1,
        0,
        2,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0
      ],
      [
        1,
        3,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        2,
        1,
        1,
        1,
        1,
        2,
        0,
        0
      ]
    ]
  },
  "moshi-moshi-ramen": {
    "issues": [
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0
      ],
      [
        1,
        0,
        1,
        0,
        0,
        2,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        2,
        1
      ],
      [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1
      ],
      [
        1,
        1,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        3,
        0,
        2,
        1,
        0,
        1,
        0,
        0
      ],
      [
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        2,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        1,
        1,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0
      ],
      [
        1,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0
      ]
    ]
  },
  "p2p-agency": {
    "issues": [
      [
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        1,
        2,
        0
      ],
      [
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        2,
        0,
        1,
        1,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0
      ],
      [
        0,
        0,
        0,
        0,
        1,
        2,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        1,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        2,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        2
      ]
    ]
  },
  "hung-thinh-land": {
    "issues": [
      [
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        1,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        1,
        0,
        0,
        0,
        1,
        0
      ],
      [
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        1,
        0,
        0,
        0
      ],
      [
        2,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        1
      ],
      [
        3,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        2,
        1,
        0,
        0,
        1,
        0,
        1,
        1
      ],
      [
        1,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        2,
        0,
        1,
        2,
        0,
        1,
        0
      ],
      [
        0,
        0,
        0,
        1,
        0,
        0,
        2,
        2,
        1,
        1,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        2,
        0
      ]
    ]
  },
  "land-tsn-air": {
    "issues": [
      [
        1,
        0,
        0,
        0,
        0,
        1,
        1,
        1,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2
      ],
      [
        0,
        0,
        0,
        0,
        0,
        2,
        1,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        2,
        1,
        0,
        0,
        0,
        0
      ],
      [
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1
      ],
      [
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        1,
        1,
        0,
        0,
        1,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        2,
        0
      ],
      [
        0,
        0,
        1,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        1,
        2,
        1,
        0,
        0
      ],
      [
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        1,
        0,
        0,
        1,
        0,
        2,
        0,
        1,
        1,
        0,
        1,
        0,
        0,
        0
      ]
    ]
  },
  "hoan-my-hospital": {
    "issues": [
      [
        1,
        0,
        2,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        2,
        0,
        2,
        1,
        0,
        1,
        1
      ],
      [
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        1,
        0,
        0,
        0,
        1,
        0,
        1,
        0,
        1
      ],
      [
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1
      ],
      [
        0,
        0,
        0,
        1,
        0,
        2,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        1,
        0
      ],
      [
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        1,
        2,
        1,
        1,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0
      ],
      [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        2,
        1,
        0,
        0,
        1,
        1,
        2,
        0,
        0,
        0,
        1,
        1
      ]
    ]
  },
  "cocacola-vietnam": {
    "issues": [
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ]
    ]
  },
  "redbull-vietnam": {
    "issues": [
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ]
    ]
  }
};







const chart08 = () => {
  const daysOfWeek = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
  const hours = Array.from({length: 24}, (_, i) => i);

  // Sử dụng dữ liệu tổng hợp từ tất cả các công ty
  const mockData = generateMockDataForAllCompanies();

  function findPeakTime(data) {
    let maxValue = 0;
    let peakHour = 0;
    let peakDay = 0;

    data.forEach((dayData, dayIndex) => {
      dayData.forEach((value, hourIndex) => {
        if (value > maxValue) {
          maxValue = value;
          peakHour = hourIndex;
          peakDay = dayIndex;
        }
      });
    });

    return {
      time: `${peakHour.toString().padStart(2, '0')}:00-${(peakHour + 1).toString().padStart(2, '0')}:00`,
      day: daysOfWeek[peakDay],
      value: maxValue
    };
  }

  function findBusiestDay(data) {
    const dayTotals = data.map(dayData => dayData.reduce((sum, val) => sum + val, 0));
    const maxIndex = dayTotals.indexOf(Math.max(...dayTotals));
    return daysOfWeek[maxIndex];
  }

  function updateKPIs(data) {
    const peak = findPeakTime(data);
    const busiestDay = findBusiestDay(data);

    document.getElementById('peak-time').textContent = peak.time;
    document.getElementById('busiest-day').textContent = busiestDay;
    document.getElementById('staffing-tip').textContent = peak.value > 20 ? 'Add 3+ staff' : peak.value > 10 ? 'Add 2 staff' : 'Add 1 staff';
  }

  // Prepare data for heatmap - each series item is a day with its hourly data
  const series = mockData.map((dayData, dayIndex) => {
    return {
      name: daysOfWeek[dayIndex],
      data: dayData.map((value, hourIndex) => {
        return {
          x: `${hourIndex.toString().padStart(2, '0')}:00`,
          y: value
        };
      })
    };
  });

  const chartEightOptions = {
    series: series,
    chart: {
      fontFamily: "Outfit, sans-serif",
      type: "heatmap",
      height: 400,
      toolbar: {
        show: false,
      },
    },
    dataLabels: {
      enabled: false
    },
    colors: ["#3b82f6"],
    plotOptions: {
      heatmap: {
        shadeIntensity: 0.5,
        radius: 0,
        useFillColorAsStroke: true,
        colorScale: {
          ranges: [
            { from: 0, to: 2, color: '#f0f9ff', name: 'Very Low' },
            { from: 3, to: 5, color: '#dbeafe', name: 'Low' },
            { from: 6, to: 10, color: '#93c5fd', name: 'Medium' },
            { from: 11, to: 15, color: '#60a5fa', name: 'High' },
            { from: 16, to: 20, color: '#3b82f6', name: 'Very High' },
            { from: 21, to: 100, color: '#1d4ed8', name: 'Critical' }
          ]
        }
      }
    },
    tooltip: {
      custom: function({ series, seriesIndex, dataPointIndex, w }) {
        const day = w.globals.seriesNames[seriesIndex];
        const hour = w.globals.labels[dataPointIndex];
        const value = series[seriesIndex][dataPointIndex];
        
        return '<div class="apexcharts-tooltip-custom" style="padding: 8px 12px; background: white; border: 1px solid #e0e0e0; border-radius: 4px;">' +
          '<div style="font-weight: 600; margin-bottom: 4px;">' + day + ' - ' + hour + '</div>' +
          '<div style="color: #3b82f6;"><span style="font-weight: 600;">' + value + '</span> issues</div>' +
          '</div>';
      }
    },
    legend: {
      show: true,
      position: 'bottom'
    }
  };

  const chartEight = new ApexCharts(document.querySelector("#chartEight"), chartEightOptions);
  chartEight.render();

  updateKPIs(mockData);
};

export default chart08;